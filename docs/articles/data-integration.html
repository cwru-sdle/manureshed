<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Using Your Own Data • manureshed</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Using Your Own Data">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">manureshed</a>

    <small class="nav-text text-default me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.1.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/getting-started.html">Getting Started</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/scenario-comparison.html">Scenario Comparison</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/advanced-features.html">Advanced Features</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/custom-efficiency-analyis.html">Custom Efficiency Analysis</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/dashboard-guide.html">Interactive Dashboard</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/visualization-guide.html">Visualization Guide</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/data-integration.html">Custom Data Integration</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/custom-efficiency-analyis.html">Custom Efficiency Analysis</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/cwru-sdle/manureshed" aria-label="GitHub repository"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Using Your Own Data</h1>
                        <h4 data-toc-skip class="author">Olatunde D.
Akanbi</h4>
            
            <h4 data-toc-skip class="date">2026-01-27</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/cwru-sdle/manureshed/blob/HEAD/vignettes/data-integration.Rmd" class="external-link"><code>vignettes/data-integration.Rmd</code></a></small>
      <div class="d-none name"><code>data-integration.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://osf.io/g39xa/" class="external-link">manureshed</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; =================================================================</span></span>
<span><span class="co">#&gt; manureshed package loaded successfully!</span></span>
<span><span class="co">#&gt; =================================================================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Built-in Data (Downloaded on-demand from OSF):</span></span>
<span><span class="co">#&gt;   • NuGIS data: 1987 - 2016 (all spatial scales)</span></span>
<span><span class="co">#&gt;   • WWTP data: 2007 - 2016 (nitrogen and phosphorus)</span></span>
<span><span class="co">#&gt;   • Spatial boundaries: county, HUC8, HUC2</span></span>
<span><span class="co">#&gt;   • Texas supplemental data (automatic for HUC8)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Quick Start:</span></span>
<span><span class="co">#&gt;   check_builtin_data()           # Check data availability</span></span>
<span><span class="co">#&gt;   download_all_data()            # Download all datasets</span></span>
<span><span class="co">#&gt;   quick_analysis()               # Complete analysis + visuals</span></span>
<span><span class="co">#&gt;   ?run_builtin_analysis          # Main workflow function</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Data Management:</span></span>
<span><span class="co">#&gt;   clear_data_cache()             # Clear downloaded data</span></span>
<span><span class="co">#&gt;   download_osf_data()            # Download specific dataset</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Documentation:</span></span>
<span><span class="co">#&gt;   vignette('getting-started')    # Getting started guide</span></span>
<span><span class="co">#&gt;   ?manureshed                    # Package overview</span></span>
<span><span class="co">#&gt; =================================================================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Data Summary:</span></span>
<span><span class="co">#&gt;   OSF Repository: https://osf.io/g39xa/</span></span>
<span><span class="co">#&gt;   Available scales: county, huc8, huc2</span></span>
<span><span class="co">#&gt;   Years available: 1987 - 2016</span></span>
<span><span class="co">#&gt;   WWTP years: 2007 - 2016 (nitrogen, phosphorus)</span></span>
<span><span class="co">#&gt;   Methodology Paper: Akanbi, O.D., Gupta, A., Mandayam, V., Flynn, K.C.,</span></span>
<span><span class="co">#&gt;       Yarus, J.M., Barcelos, E.I., French, R.H., 2026. Towards circular nutrient economies: An</span></span>
<span><span class="co">#&gt;       integrated manureshed framework for agricultural and municipal resource management.</span></span>
<span><span class="co">#&gt;       Resources, Conservation and Recycling, https://doi.org/10.1016/j.resconrec.2025.108697</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Cached datasets: 12/10 downloaded</span></span>
<span><span class="co">#&gt; </span></span></code></pre></div>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>The <code>manureshed</code> package includes data from 1987-2016, but
you can add your own:</p>
<ul>
<li>
<strong>WWTP data</strong> for years outside 2007-2016</li>
<li>
<strong>Agricultural data</strong> from other sources<br>
</li>
<li><strong>Custom spatial boundaries</strong></li>
<li><strong>Industrial or urban nutrient sources</strong></li>
</ul>
</div>
<div class="section level2">
<h2 id="using-custom-wwtp-data">Using Custom WWTP Data<a class="anchor" aria-label="anchor" href="#using-custom-wwtp-data"></a>
</h2>
<div class="section level3">
<h3 id="for-years-outside-2007-2016">For Years Outside 2007-2016<a class="anchor" aria-label="anchor" href="#for-years-outside-2007-2016"></a>
</h3>
<p>The package has WWTP data for 2007-2016. For other years, provide
your own:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Use your WWTP files for 2020</span></span>
<span><span class="va">results_2020</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_builtin_analysis.html">run_builtin_analysis</a></span><span class="op">(</span></span>
<span>  scale <span class="op">=</span> <span class="st">"huc8"</span>,</span>
<span>  year <span class="op">=</span> <span class="fl">2020</span>,  <span class="co"># Agricultural data available 1987-2016</span></span>
<span>  nutrients <span class="op">=</span> <span class="st">"nitrogen"</span>,</span>
<span>  include_wwtp <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  custom_wwtp_nitrogen <span class="op">=</span> <span class="st">"nitrogen_2021.csv"</span>,</span>
<span>  wwtp_load_units <span class="op">=</span> <span class="st">"kg"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 3. Check results</span></span>
<span><span class="fu"><a href="../reference/summarize_results.html">summarize_results</a></span><span class="op">(</span><span class="va">results_custom</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/quick_check.html">quick_check</a></span><span class="op">(</span><span class="va">results_custom</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 4. Create maps</span></span>
<span><span class="va">nitrogen_map</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/map_agricultural_classification.html">map_agricultural_classification</a></span><span class="op">(</span></span>
<span>  <span class="va">results_custom</span><span class="op">$</span><span class="va">integrated</span><span class="op">$</span><span class="va">nitrogen</span>,</span>
<span>  <span class="st">"nitrogen"</span>, <span class="st">"combined_N_class"</span>,</span>
<span>  <span class="st">"2021 Nitrogen with Custom WWTP Data"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/save_plot.html">save_plot</a></span><span class="op">(</span><span class="va">nitrogen_map</span>, <span class="st">"custom_analysis_2021.png"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 5. Save results</span></span>
<span><span class="fu"><a href="../reference/save_spatial_data.html">save_spatial_data</a></span><span class="op">(</span></span>
<span>  <span class="va">results_custom</span><span class="op">$</span><span class="va">integrated</span><span class="op">$</span><span class="va">nitrogen</span>,</span>
<span>  <span class="st">"nitrogen_2021_results.rds"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>This example shows the complete workflow from custom data to final
maps and saved results.</p>
</div>
</div>
<div class="section level2">
<h2 id="advanced-custom-data-integration">Advanced Custom Data Integration<a class="anchor" aria-label="anchor" href="#advanced-custom-data-integration"></a>
</h2>
<div class="section level3">
<h3 id="adding-other-nutrient-sources">Adding Other Nutrient Sources<a class="anchor" aria-label="anchor" href="#adding-other-nutrient-sources"></a>
</h3>
<p>You can integrate additional nutrient sources beyond WWTP:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example: Adding industrial sources</span></span>
<span><span class="va">industrial_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Facility_Name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Steel Plant A"</span>, <span class="st">"Chemical Plant B"</span>, <span class="st">"Food Processor C"</span><span class="op">)</span>,</span>
<span>  Lat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">41.5</span>, <span class="fl">40.7</span>, <span class="fl">42.1</span><span class="op">)</span>,</span>
<span>  Long <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">81.7</span>, <span class="op">-</span><span class="fl">82.1</span>, <span class="op">-</span><span class="fl">83.5</span><span class="op">)</span>,</span>
<span>  N_Load_tons <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">75</span>, <span class="fl">30</span><span class="op">)</span>,</span>
<span>  P_Load_tons <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">8</span><span class="op">)</span>,</span>
<span>  Source_Type <span class="op">=</span> <span class="st">"Industrial"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Convert to spatial format</span></span>
<span><span class="va">industrial_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">industrial_data</span>, </span>
<span>                         coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Long"</span>, <span class="st">"Lat"</span><span class="op">)</span>, </span>
<span>                         crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="fl">5070</span><span class="op">)</span>  <span class="co"># Transform to analysis CRS</span></span>
<span></span>
<span><span class="co"># Aggregate by spatial units (example for HUC8)</span></span>
<span><span class="va">boundaries</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_builtin_boundaries.html">load_builtin_boundaries</a></span><span class="op">(</span><span class="st">"huc8"</span><span class="op">)</span></span>
<span><span class="va">industrial_aggregated</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wwtp_aggregate_by_boundaries.html">wwtp_aggregate_by_boundaries</a></span><span class="op">(</span></span>
<span>  <span class="va">industrial_sf</span>, <span class="va">boundaries</span>, <span class="st">"nitrogen"</span>, <span class="st">"huc8"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add to existing results</span></span>
<span><span class="co"># (You would modify the integration functions to include industrial sources)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="working-with-different-time-periods">Working with Different Time Periods<a class="anchor" aria-label="anchor" href="#working-with-different-time-periods"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a time series dataset</span></span>
<span><span class="va">years_to_analyze</span> <span class="op">&lt;-</span> <span class="fl">2018</span><span class="op">:</span><span class="fl">2022</span></span>
<span><span class="va">time_series_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">year</span> <span class="kw">in</span> <span class="va">years_to_analyze</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Check if you have WWTP data for this year</span></span>
<span>  <span class="va">wwtp_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"wwtp_nitrogen_"</span>, <span class="va">year</span>, <span class="st">".csv"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="va">wwtp_file</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_results</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_builtin_analysis.html">run_builtin_analysis</a></span><span class="op">(</span></span>
<span>      scale <span class="op">=</span> <span class="st">"huc8"</span>,</span>
<span>      year <span class="op">=</span> <span class="va">year</span>,</span>
<span>      nutrients <span class="op">=</span> <span class="st">"nitrogen"</span>,</span>
<span>      include_wwtp <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>      custom_wwtp_nitrogen <span class="op">=</span> <span class="va">wwtp_file</span>,</span>
<span>      save_outputs <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>      verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="co"># Agricultural only if no WWTP data</span></span>
<span>    <span class="va">time_series_results</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_builtin_analysis.html">run_builtin_analysis</a></span><span class="op">(</span></span>
<span>      scale <span class="op">=</span> <span class="st">"huc8"</span>, </span>
<span>      year <span class="op">=</span> <span class="va">year</span>,</span>
<span>      nutrients <span class="op">=</span> <span class="st">"nitrogen"</span>,</span>
<span>      include_wwtp <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>      save_outputs <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>      verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Compare results across years</span></span>
<span><span class="va">yearly_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">time_series_results</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="va">time_series_results</span><span class="op">[[</span><span class="va">year</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">classes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">agricultural</span><span class="op">$</span><span class="va">N_class</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    Year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span>,</span>
<span>    Total_Units <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">classes</span><span class="op">)</span>,</span>
<span>    Source_Units <span class="op">=</span> <span class="va">classes</span><span class="op">[</span><span class="st">"Source"</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/Control.html" class="external-link">%||%</a></span> <span class="fl">0</span>,</span>
<span>    Sink_Units <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">classes</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Sink_Deficit"</span>, <span class="st">"Sink_Fertilizer"</span><span class="op">)</span><span class="op">]</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    Excluded_Units <span class="op">=</span> <span class="va">classes</span><span class="op">[</span><span class="st">"Excluded"</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/Control.html" class="external-link">%||%</a></span> <span class="fl">0</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">yearly_summary</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="custom-agricultural-data">Custom Agricultural Data<a class="anchor" aria-label="anchor" href="#custom-agricultural-data"></a>
</h3>
<p>If you have agricultural data from other sources:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example: Custom agricultural data format</span></span>
<span><span class="va">custom_farm_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  County_FIPS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"39001"</span>, <span class="st">"39003"</span>, <span class="st">"39005"</span><span class="op">)</span>,</span>
<span>  Manure_N_kg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100000</span>, <span class="fl">150000</span>, <span class="fl">200000</span><span class="op">)</span>,</span>
<span>  Manure_P_kg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20000</span>, <span class="fl">30000</span>, <span class="fl">40000</span><span class="op">)</span>,</span>
<span>  Fertilizer_N_kg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50000</span>, <span class="fl">75000</span>, <span class="fl">100000</span><span class="op">)</span>,</span>
<span>  Fertilizer_P_kg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10000</span>, <span class="fl">15000</span>, <span class="fl">20000</span><span class="op">)</span>,</span>
<span>  N_Fixation_kg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25000</span>, <span class="fl">40000</span>, <span class="fl">35000</span><span class="op">)</span>,</span>
<span>  Crop_N_Removal_kg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">80000</span>, <span class="fl">120000</span>, <span class="fl">140000</span><span class="op">)</span>,</span>
<span>  Crop_P_Removal_kg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">15000</span>, <span class="fl">25000</span>, <span class="fl">30000</span><span class="op">)</span>,</span>
<span>  Cropland_acres <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">45000</span>, <span class="fl">67000</span>, <span class="fl">52000</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Convert to package format</span></span>
<span><span class="va">standardized_farm_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  ID <span class="op">=</span> <span class="va">custom_farm_data</span><span class="op">$</span><span class="va">County_FIPS</span>,</span>
<span>  NAME <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"County"</span>, <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">custom_farm_data</span><span class="op">$</span><span class="va">County_FIPS</span>, <span class="fl">3</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  manure_N <span class="op">=</span> <span class="va">custom_farm_data</span><span class="op">$</span><span class="va">Manure_N_kg</span>,</span>
<span>  manure_P <span class="op">=</span> <span class="va">custom_farm_data</span><span class="op">$</span><span class="va">Manure_P_kg</span>,</span>
<span>  fertilizer_N <span class="op">=</span> <span class="va">custom_farm_data</span><span class="op">$</span><span class="va">Fertilizer_N_kg</span>,</span>
<span>  fertilizer_P <span class="op">=</span> <span class="va">custom_farm_data</span><span class="op">$</span><span class="va">Fertilizer_P_kg</span>,</span>
<span>  N_fixation <span class="op">=</span> <span class="va">custom_farm_data</span><span class="op">$</span><span class="va">N_Fixation_kg</span>,</span>
<span>  crop_removal_N <span class="op">=</span> <span class="va">custom_farm_data</span><span class="op">$</span><span class="va">Crop_N_Removal_kg</span>,</span>
<span>  crop_removal_P <span class="op">=</span> <span class="va">custom_farm_data</span><span class="op">$</span><span class="va">Crop_P_Removal_kg</span>,</span>
<span>  cropland <span class="op">=</span> <span class="va">custom_farm_data</span><span class="op">$</span><span class="va">Cropland_acres</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Apply classifications</span></span>
<span><span class="va">custom_classified</span> <span class="op">&lt;-</span> <span class="va">standardized_farm_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/agri_classify_nitrogen.html">agri_classify_nitrogen</a></span><span class="op">(</span>cropland_threshold <span class="op">=</span> <span class="fl">1234</span>, scale <span class="op">=</span> <span class="st">"county"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/agri_classify_phosphorus.html">agri_classify_phosphorus</a></span><span class="op">(</span>cropland_threshold <span class="op">=</span> <span class="fl">1234</span>, scale <span class="op">=</span> <span class="st">"county"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">custom_classified</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="data-validation-and-quality-control">Data Validation and Quality Control<a class="anchor" aria-label="anchor" href="#data-validation-and-quality-control"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Function to validate your custom data</span></span>
<span><span class="va">validate_custom_data</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">data_type</span> <span class="op">=</span> <span class="st">"wwtp"</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">issues</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">data_type</span> <span class="op">==</span> <span class="st">"wwtp"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Check required columns</span></span>
<span>    <span class="va">required_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Facility_Name"</span>, <span class="st">"Lat"</span>, <span class="st">"Long"</span><span class="op">)</span></span>
<span>    <span class="va">missing_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/setops.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="va">required_cols</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">missing_cols</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">issues</span><span class="op">$</span><span class="va">missing_columns</span> <span class="op">&lt;-</span> <span class="va">missing_cols</span></span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>    <span class="co"># Check coordinate ranges (for US)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="st">"Lat"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="st">"Long"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">invalid_coords</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">Lat</span> <span class="op">&lt;</span> <span class="fl">24</span> <span class="op">|</span> <span class="va">data</span><span class="op">$</span><span class="va">Lat</span> <span class="op">&gt;</span> <span class="fl">50</span> <span class="op">|</span> </span>
<span>                           <span class="va">data</span><span class="op">$</span><span class="va">Long</span> <span class="op">&lt;</span> <span class="op">-</span><span class="fl">125</span> <span class="op">|</span> <span class="va">data</span><span class="op">$</span><span class="va">Long</span> <span class="op">&gt;</span> <span class="op">-</span><span class="fl">66</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="va">invalid_coords</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">issues</span><span class="op">$</span><span class="va">invalid_coordinates</span> <span class="op">&lt;-</span> <span class="va">invalid_coords</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>    <span class="co"># Check for negative loads</span></span>
<span>    <span class="va">load_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"Load|load"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">col</span> <span class="kw">in</span> <span class="va">load_cols</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="va">col</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">negative_loads</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">data</span><span class="op">[[</span><span class="va">col</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;</span> <span class="fl">0</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="va">negative_loads</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>          <span class="va">issues</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"negative_"</span>, <span class="va">col</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">negative_loads</span></span>
<span>        <span class="op">}</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">data_type</span> <span class="op">==</span> <span class="st">"agricultural"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Check for negative values in nutrient data</span></span>
<span>    <span class="va">nutrient_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"manure_N"</span>, <span class="st">"manure_P"</span>, <span class="st">"fertilizer_N"</span>, <span class="st">"fertilizer_P"</span>,</span>
<span>                       <span class="st">"crop_removal_N"</span>, <span class="st">"crop_removal_P"</span>, <span class="st">"cropland"</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">col</span> <span class="kw">in</span> <span class="va">nutrient_cols</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="va">col</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">negative_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">data</span><span class="op">[[</span><span class="va">col</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;</span> <span class="fl">0</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="va">negative_values</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>          <span class="va">issues</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"negative_"</span>, <span class="va">col</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">negative_values</span></span>
<span>        <span class="op">}</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">issues</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"âœ“ Data validation passed"</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"âš  Data validation issues found:"</span><span class="op">)</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">issue</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">issues</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"  "</span>, <span class="va">issue</span>, <span class="st">": "</span>, <span class="va">issues</span><span class="op">[[</span><span class="va">issue</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">issues</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Use the validation function</span></span>
<span><span class="co"># validate_custom_data(your_wwtp_data, "wwtp")</span></span>
<span><span class="co"># validate_custom_data(your_farm_data, "agricultural")</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="exporting-results">Exporting Results<a class="anchor" aria-label="anchor" href="#exporting-results"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Export results in different formats</span></span>
<span><span class="va">export_analysis_results</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">results</span>, <span class="va">output_dir</span> <span class="op">=</span> <span class="st">"exports"</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">output_dir</span>, showWarnings <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Export agricultural data as CSV</span></span>
<span>  <span class="va">agri_csv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">agricultural</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">agri_csv</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">output_dir</span>, <span class="st">"agricultural_results.csv"</span><span class="op">)</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Export as shapefile (if sf package available)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"sf"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_write.html" class="external-link">st_write</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">agricultural</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">output_dir</span>, <span class="st">"agricultural_results.shp"</span><span class="op">)</span>, </span>
<span>             delete_dsn <span class="op">=</span> <span class="cn">TRUE</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># Export WWTP facilities if available</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="st">"wwtp"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">nutrient</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">wwtp</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">facility_data</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">$</span><span class="va">wwtp</span><span class="op">[[</span><span class="va">nutrient</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">facility_data</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">facility_data</span>, </span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">output_dir</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"wwtp_"</span>, <span class="va">nutrient</span>, <span class="st">"_facilities.csv"</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># Export integrated results if available</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="st">"integrated"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">nutrient</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">integrated</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">integrated_csv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">integrated</span><span class="op">[[</span><span class="va">nutrient</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">integrated_csv</span>, </span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">output_dir</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"integrated_"</span>, <span class="va">nutrient</span>, <span class="st">"_results.csv"</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Results exported to: "</span>, <span class="va">output_dir</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Use the export function</span></span>
<span><span class="co"># export_analysis_results(results_custom, "my_exports")</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="troubleshooting-common-issues">Troubleshooting Common Issues<a class="anchor" aria-label="anchor" href="#troubleshooting-common-issues"></a>
</h2>
<div class="section level3">
<h3 id="wwtp-data-issues">WWTP Data Issues<a class="anchor" aria-label="anchor" href="#wwtp-data-issues"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Common WWTP data problems and solutions</span></span>
<span></span>
<span><span class="co"># Problem 1: "No valid facilities remaining after cleaning"</span></span>
<span><span class="co"># Solution: Check coordinates and load values</span></span>
<span><span class="va">wwtp_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"your_wwtp_file.csv"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">wwtp_data</span><span class="op">)</span>  <span class="co"># Look for obvious issues</span></span>
<span></span>
<span><span class="co"># Check coordinate ranges</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">wwtp_data</span><span class="op">$</span><span class="va">Latitude</span><span class="op">)</span>   <span class="co"># Should be ~24-50 for US</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">wwtp_data</span><span class="op">$</span><span class="va">Longitude</span><span class="op">)</span>  <span class="co"># Should be ~-125 to -66 for US</span></span>
<span></span>
<span><span class="co"># Check load values</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">wwtp_data</span><span class="op">$</span><span class="va">Load</span><span class="op">)</span>  <span class="co"># Should be positive numbers</span></span>
<span></span>
<span><span class="co"># Problem 2: Wrong coordinate system</span></span>
<span><span class="co"># Solution: Make sure coordinates are in decimal degrees (not UTM)</span></span>
<span><span class="co"># Example conversion if needed:</span></span>
<span><span class="co"># library(sf)</span></span>
<span><span class="co"># points_utm &lt;- st_as_sf(data, coords = c("X_UTM", "Y_UTM"), crs = 32617)</span></span>
<span><span class="co"># points_dd &lt;- st_transform(points_utm, 4326)</span></span>
<span><span class="co"># coords_dd &lt;- st_coordinates(points_dd)</span></span>
<span></span>
<span><span class="co"># Problem 3: Mixed units in same file</span></span>
<span><span class="co"># Solution: Standardize units before analysis</span></span>
<span><span class="va">standardize_mixed_units</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">load_col</span>, <span class="va">unit_col</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">data</span><span class="op">$</span><span class="va">standardized_load</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span></span>
<span>    <span class="va">data</span><span class="op">[[</span><span class="va">unit_col</span><span class="op">]</span><span class="op">]</span> <span class="op">==</span> <span class="st">"kg"</span>, <span class="va">data</span><span class="op">[[</span><span class="va">load_col</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">data</span><span class="op">[[</span><span class="va">unit_col</span><span class="op">]</span><span class="op">]</span> <span class="op">==</span> <span class="st">"lbs"</span>, <span class="va">data</span><span class="op">[[</span><span class="va">load_col</span><span class="op">]</span><span class="op">]</span> <span class="op">/</span> <span class="fl">2.20462</span>,</span>
<span>           <span class="va">data</span><span class="op">[[</span><span class="va">load_col</span><span class="op">]</span><span class="op">]</span> <span class="op">*</span> <span class="fl">907.185</span><span class="op">)</span>  <span class="co"># assuming tons</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="agricultural-data-issues">Agricultural Data Issues<a class="anchor" aria-label="anchor" href="#agricultural-data-issues"></a>
</h3>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Common agricultural data problems</span></span>
<span></span>
<span><span class="co"># Problem: Impossible nutrient balances</span></span>
<span><span class="co"># Solution: Check your units and conversion factors</span></span>
<span><span class="va">check_nutrient_balance</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Calculate simple checks</span></span>
<span>  <span class="va">data</span><span class="op">$</span><span class="va">total_inputs_N</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">manure_N</span> <span class="op">+</span> <span class="va">data</span><span class="op">$</span><span class="va">fertilizer_N</span> <span class="op">+</span> <span class="va">data</span><span class="op">$</span><span class="va">N_fixation</span></span>
<span>  <span class="va">data</span><span class="op">$</span><span class="va">efficiency_N</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">crop_removal_N</span> <span class="op">/</span> <span class="va">data</span><span class="op">$</span><span class="va">total_inputs_N</span></span>
<span>  </span>
<span>  <span class="co"># Flag suspicious values</span></span>
<span>  <span class="va">suspicious</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">efficiency_N</span> <span class="op">&gt;</span> <span class="fl">2.0</span> <span class="op">|</span> <span class="va">data</span><span class="op">$</span><span class="va">efficiency_N</span> <span class="op">&lt;</span> <span class="fl">0.1</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">suspicious</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Warning: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">suspicious</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="st">" units have suspicious N efficiency"</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span><span class="va">suspicious</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ID"</span>, <span class="st">"total_inputs_N"</span>, <span class="st">"crop_removal_N"</span>, <span class="st">"efficiency_N"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Problem: Missing spatial boundaries</span></span>
<span><span class="co"># Solution: Use built-in boundaries or provide your own</span></span>
<span><span class="co"># county_boundaries &lt;- load_builtin_boundaries("county")</span></span>
<span><span class="co"># your_data_with_boundaries &lt;- merge(your_data, county_boundaries, by.x = "FIPS", by.y = "FIPS")</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="getting-help">Getting Help<a class="anchor" aria-label="anchor" href="#getting-help"></a>
</h2>
<div class="section level3">
<h3 id="common-questions">Common Questions<a class="anchor" aria-label="anchor" href="#common-questions"></a>
</h3>
<p><strong>Q: What format should my WWTP data be in?</strong> A: CSV
file with columns for facility name, latitude, longitude, annual load,
and state. The package can auto-detect most EPA formats.</p>
<p><strong>Q: What units can I use for loads?</strong><br>
A: “kg”, “lbs”, “pounds”, or “tons”. Specify with
<code>wwtp_load_units</code>.</p>
<p><strong>Q: Can I use data from other countries?</strong> A: The
spatial boundaries are US-only, but you could provide your own
boundaries and modify the coordinate system.</p>
<p><strong>Q: How do I handle missing data?</strong> A: The package
excludes facilities with missing coordinates or loads. Clean your data
first for best results.</p>
<p><strong>Q: My analysis is running slowly. What can I do?</strong> A:
Try using a smaller spatial scale (HUC2 &lt; HUC8 &lt; County in terms
of processing time), fewer years, or clear the data cache with
<code><a href="../reference/clear_data_cache.html">clear_data_cache()</a></code>.</p>
<p><strong>Q: How do I cite the package and data?</strong> A: Use
<code><a href="../reference/citation_info.html">citation_info()</a></code> to get proper citations for the package and
underlying datasets.</p>
</div>
<div class="section level3">
<h3 id="function-help">Function Help<a class="anchor" aria-label="anchor" href="#function-help"></a>
</h3>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get help on specific functions</span></span>
<span><span class="op">?</span><span class="va">load_user_wwtp</span></span>
<span><span class="op">?</span><span class="va">run_builtin_analysis</span>  </span>
<span><span class="op">?</span><span class="va">wwtp_clean_data</span></span>
<span></span>
<span><span class="co"># Check what data is available</span></span>
<span><span class="fu"><a href="../reference/check_builtin_data.html">check_builtin_data</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/list_available_years.html">list_available_years</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Package health check</span></span>
<span><span class="fu"><a href="../reference/health_check.html">health_check</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Test data download connection</span></span>
<span><span class="fu"><a href="../reference/test_osf_connection.html">test_osf_connection</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="getting-more-help">Getting More Help<a class="anchor" aria-label="anchor" href="#getting-more-help"></a>
</h3>
<ul>
<li>Check the other vignettes: <code><a href="../articles/getting-started.html">vignette("getting-started")</a></code>,
<code><a href="../articles/visualization-guide.html">vignette("visualization-guide")</a></code>,
<code><a href="../articles/advanced-features.html">vignette("advanced-features")</a></code>
</li>
<li>Look at function documentation: <code>?function_name</code>
</li>
<li>Check the package website or GitHub repository for examples</li>
<li>Use <code><a href="../reference/quick_check.html">quick_check()</a></code> to validate your results</li>
</ul>
<p>The <code>manureshed</code> package is designed to work with your
data as easily as possible. Start with the built-in examples, then
gradually add your own data as needed.nitrogen_2020.csv” )</p>
</div>
<div class="section level3">
<h3 id="handling-different-data-formats">Handling Different Data Formats<a class="anchor" aria-label="anchor" href="#handling-different-data-formats"></a>
</h3>
<div class="section level4">
<h4 id="standard-epa-format">Standard EPA Format<a class="anchor" aria-label="anchor" href="#standard-epa-format"></a>
</h4>
<p>Most EPA WWTP files work automatically:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Standard EPA format (auto-detected)</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_builtin_analysis.html">run_builtin_analysis</a></span><span class="op">(</span></span>
<span>  scale <span class="op">=</span> <span class="st">"county"</span>,</span>
<span>  year <span class="op">=</span> <span class="fl">2018</span>,</span>
<span>  nutrients <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"nitrogen"</span>, <span class="st">"phosphorus"</span><span class="op">)</span>,</span>
<span>  include_wwtp <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  custom_wwtp_nitrogen <span class="op">=</span> <span class="st">"nitrogen_2018.csv"</span>,</span>
<span>  custom_wwtp_phosphorus <span class="op">=</span> <span class="st">"phosphorus_2018.csv"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="different-units">Different Units<a class="anchor" aria-label="anchor" href="#different-units"></a>
</h4>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># If your data uses pounds instead of kg</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_builtin_analysis.html">run_builtin_analysis</a></span><span class="op">(</span></span>
<span>  scale <span class="op">=</span> <span class="st">"huc8"</span>, </span>
<span>  year <span class="op">=</span> <span class="fl">2019</span>,</span>
<span>  nutrients <span class="op">=</span> <span class="st">"nitrogen"</span>,</span>
<span>  include_wwtp <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  custom_wwtp_nitrogen <span class="op">=</span> <span class="st">"nitrogen_pounds_2019.csv"</span>,</span>
<span>  wwtp_load_units <span class="op">=</span> <span class="st">"lbs"</span>  <span class="co"># Converts automatically</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Other units: "kg", "lbs", "pounds", "tons"</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="different-file-format">Different File Format<a class="anchor" aria-label="anchor" href="#different-file-format"></a>
</h4>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># If headers are in different rows</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_builtin_analysis.html">run_builtin_analysis</a></span><span class="op">(</span></span>
<span>  scale <span class="op">=</span> <span class="st">"county"</span>,</span>
<span>  year <span class="op">=</span> <span class="fl">2021</span>, </span>
<span>  nutrients <span class="op">=</span> <span class="st">"nitrogen"</span>,</span>
<span>  include_wwtp <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  custom_wwtp_nitrogen <span class="op">=</span> <span class="st">"nitrogen_2021.csv"</span>,</span>
<span>  wwtp_skip_rows <span class="op">=</span> <span class="fl">3</span>,      <span class="co"># Skip first 3 rows</span></span>
<span>  wwtp_header_row <span class="op">=</span> <span class="fl">1</span>      <span class="co"># Headers in row 1 after skipping</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="custom-column-names">Custom Column Names<a class="anchor" aria-label="anchor" href="#custom-column-names"></a>
</h4>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># If your columns have different names</span></span>
<span><span class="va">custom_mapping</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  facility_name <span class="op">=</span> <span class="st">"Plant_Name"</span>,</span>
<span>  latitude <span class="op">=</span> <span class="st">"Lat_DD"</span>,</span>
<span>  longitude <span class="op">=</span> <span class="st">"Long_DD"</span>, </span>
<span>  pollutant_load <span class="op">=</span> <span class="st">"Annual_Load_kg"</span>,</span>
<span>  state <span class="op">=</span> <span class="st">"State_Code"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_builtin_analysis.html">run_builtin_analysis</a></span><span class="op">(</span></span>
<span>  scale <span class="op">=</span> <span class="st">"huc8"</span>,</span>
<span>  year <span class="op">=</span> <span class="fl">2022</span>,</span>
<span>  nutrients <span class="op">=</span> <span class="st">"nitrogen"</span>, </span>
<span>  include_wwtp <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  custom_wwtp_nitrogen <span class="op">=</span> <span class="st">"custom_format.csv"</span>,</span>
<span>  wwtp_column_mapping <span class="op">=</span> <span class="va">custom_mapping</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="manual-wwtp-processing">Manual WWTP Processing<a class="anchor" aria-label="anchor" href="#manual-wwtp-processing"></a>
</h3>
<p>For full control, process WWTP data step by step:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Step 1: Load your WWTP file</span></span>
<span><span class="va">wwtp_raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_user_wwtp.html">load_user_wwtp</a></span><span class="op">(</span></span>
<span>  file_path <span class="op">=</span> <span class="st">"nitrogen_2020.csv"</span>,</span>
<span>  nutrient <span class="op">=</span> <span class="st">"nitrogen"</span>,</span>
<span>  load_units <span class="op">=</span> <span class="st">"lbs"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Step 2: Clean the data</span></span>
<span><span class="va">wwtp_clean</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wwtp_clean_data.html">wwtp_clean_data</a></span><span class="op">(</span><span class="va">wwtp_raw</span>, <span class="st">"nitrogen"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Step 3: Classify facilities by size</span></span>
<span><span class="va">wwtp_classified</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wwtp_classify_sources.html">wwtp_classify_sources</a></span><span class="op">(</span><span class="va">wwtp_clean</span>, <span class="st">"nitrogen"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Step 4: Convert to spatial format</span></span>
<span><span class="va">wwtp_spatial</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wwtp_to_spatial.html">wwtp_to_spatial</a></span><span class="op">(</span><span class="va">wwtp_classified</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Step 5: Load boundaries and aggregate by spatial units</span></span>
<span><span class="va">boundaries</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_builtin_boundaries.html">load_builtin_boundaries</a></span><span class="op">(</span><span class="st">"huc8"</span><span class="op">)</span></span>
<span><span class="va">wwtp_aggregated</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wwtp_aggregate_by_boundaries.html">wwtp_aggregate_by_boundaries</a></span><span class="op">(</span></span>
<span>  <span class="va">wwtp_spatial</span>, <span class="va">boundaries</span>, <span class="st">"nitrogen"</span>, <span class="st">"huc8"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Step 6: Integrate with agricultural data</span></span>
<span><span class="va">agri_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_builtin_nugis.html">load_builtin_nugis</a></span><span class="op">(</span><span class="st">"huc8"</span>, <span class="fl">2020</span><span class="op">)</span></span>
<span><span class="va">agri_processed</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/agri_classify_complete.html">agri_classify_complete</a></span><span class="op">(</span><span class="va">agri_data</span>, <span class="st">"huc8"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">integrated</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/integrate_wwtp_agricultural.html">integrate_wwtp_agricultural</a></span><span class="op">(</span></span>
<span>  <span class="va">agri_processed</span>, <span class="va">wwtp_aggregated</span>, <span class="st">"nitrogen"</span>, </span>
<span>  cropland_threshold <span class="op">=</span> <span class="fl">1234</span>, scale <span class="op">=</span> <span class="st">"huc8"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="unit-conversions">Unit Conversions<a class="anchor" aria-label="anchor" href="#unit-conversions"></a>
</h2>
<div class="section level3">
<h3 id="common-conversions">Common Conversions<a class="anchor" aria-label="anchor" href="#common-conversions"></a>
</h3>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Convert between units</span></span>
<span><span class="va">kg_loads</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">2000</span>, <span class="fl">5000</span><span class="op">)</span></span>
<span><span class="va">tons_loads</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/convert_load_units.html">convert_load_units</a></span><span class="op">(</span><span class="va">kg_loads</span>, <span class="st">"kg"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lbs_loads</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2000</span>, <span class="fl">4000</span>, <span class="fl">10000</span><span class="op">)</span>  </span>
<span><span class="va">tons_loads</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/convert_load_units.html">convert_load_units</a></span><span class="op">(</span><span class="va">lbs_loads</span>, <span class="st">"lbs"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Original_kg <span class="op">=</span> <span class="va">kg_loads</span>,</span>
<span>  Converted_tons <span class="op">=</span> <span class="fu"><a href="../reference/convert_load_units.html">convert_load_units</a></span><span class="op">(</span><span class="va">kg_loads</span>, <span class="st">"kg"</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="handling-p2o5-vs-p">Handling P2O5 vs P<a class="anchor" aria-label="anchor" href="#handling-p2o5-vs-p"></a>
</h3>
<p>The package automatically converts P2O5 to P, but you can do it
manually:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># If you have P2O5 data, convert to P</span></span>
<span><span class="va">p2o5_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">200</span>, <span class="fl">300</span><span class="op">)</span>  <span class="co"># kg P2O5</span></span>
<span><span class="va">p_values</span> <span class="op">&lt;-</span> <span class="va">p2o5_values</span> <span class="op">*</span> <span class="va">P2O5_TO_P</span>  <span class="co"># Convert to P</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"P2O5 to P conversion factor:"</span>, <span class="va">P2O5_TO_P</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="working-with-different-spatial-scales">Working with Different Spatial Scales<a class="anchor" aria-label="anchor" href="#working-with-different-spatial-scales"></a>
</h2>
<div class="section level3">
<h3 id="county-data-fips-codes">County Data (FIPS Codes)<a class="anchor" aria-label="anchor" href="#county-data-fips-codes"></a>
</h3>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># County analysis - make sure you have 5-digit FIPS codes</span></span>
<span><span class="va">county_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_builtin_analysis.html">run_builtin_analysis</a></span><span class="op">(</span></span>
<span>  scale <span class="op">=</span> <span class="st">"county"</span>,</span>
<span>  year <span class="op">=</span> <span class="fl">2016</span>,</span>
<span>  nutrients <span class="op">=</span> <span class="st">"nitrogen"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Your county WWTP data should have state and county info</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="huc8-watersheds">HUC8 Watersheds<a class="anchor" aria-label="anchor" href="#huc8-watersheds"></a>
</h3>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># HUC8 analysis - 8-digit watershed codes</span></span>
<span><span class="va">huc8_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_builtin_analysis.html">run_builtin_analysis</a></span><span class="op">(</span></span>
<span>  scale <span class="op">=</span> <span class="st">"huc8"</span>, </span>
<span>  year <span class="op">=</span> <span class="fl">2016</span>,</span>
<span>  nutrients <span class="op">=</span> <span class="st">"nitrogen"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make sure HUC8 codes are 8 digits (add leading zero if needed)</span></span>
<span><span class="va">huc8_codes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"4110001"</span>, <span class="st">"4110002"</span><span class="op">)</span>  <span class="co"># 7 digits</span></span>
<span><span class="va">formatted_codes</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/format_huc8.html">format_huc8</a></span><span class="op">(</span><span class="va">huc8_codes</span><span class="op">)</span>  <span class="co"># Adds leading zero</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">formatted_codes</span><span class="op">)</span>  <span class="co"># "04110001", "04110002"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="huc2-regions">HUC2 Regions<a class="anchor" aria-label="anchor" href="#huc2-regions"></a>
</h3>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># HUC2 analysis - 2-digit regional codes</span></span>
<span><span class="va">huc2_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_builtin_analysis.html">run_builtin_analysis</a></span><span class="op">(</span></span>
<span>  scale <span class="op">=</span> <span class="st">"huc2"</span>,</span>
<span>  year <span class="op">=</span> <span class="fl">2016</span>, </span>
<span>  nutrients <span class="op">=</span> <span class="st">"nitrogen"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="state-specific-analysis">State-Specific Analysis<a class="anchor" aria-label="anchor" href="#state-specific-analysis"></a>
</h2>
<div class="section level3">
<h3 id="single-state">Single State<a class="anchor" aria-label="anchor" href="#single-state"></a>
</h3>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Analyze just one state</span></span>
<span><span class="va">iowa_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_state_analysis.html">run_state_analysis</a></span><span class="op">(</span></span>
<span>  state <span class="op">=</span> <span class="st">"IA"</span>,</span>
<span>  scale <span class="op">=</span> <span class="st">"county"</span>,</span>
<span>  year <span class="op">=</span> <span class="fl">2016</span>,</span>
<span>  nutrients <span class="op">=</span> <span class="st">"nitrogen"</span>,</span>
<span>  include_wwtp <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># With custom WWTP data</span></span>
<span><span class="va">texas_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_state_analysis.html">run_state_analysis</a></span><span class="op">(</span></span>
<span>  state <span class="op">=</span> <span class="st">"TX"</span>,</span>
<span>  scale <span class="op">=</span> <span class="st">"huc8"</span>,</span>
<span>  year <span class="op">=</span> <span class="fl">2020</span>,</span>
<span>  nutrients <span class="op">=</span> <span class="st">"nitrogen"</span>, </span>
<span>  include_wwtp <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  custom_wwtp_nitrogen <span class="op">=</span> <span class="st">"texas_wwtp_2020.csv"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="multiple-states">Multiple States<a class="anchor" aria-label="anchor" href="#multiple-states"></a>
</h3>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Analyze several states</span></span>
<span><span class="va">midwest_states</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"IA"</span>, <span class="st">"IL"</span>, <span class="st">"IN"</span>, <span class="st">"OH"</span><span class="op">)</span> </span>
<span><span class="va">state_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">state</span> <span class="kw">in</span> <span class="va">midwest_states</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">state_results</span><span class="op">[[</span><span class="va">state</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_state_analysis.html">run_state_analysis</a></span><span class="op">(</span></span>
<span>    state <span class="op">=</span> <span class="va">state</span>,</span>
<span>    scale <span class="op">=</span> <span class="st">"county"</span>,</span>
<span>    year <span class="op">=</span> <span class="fl">2016</span>,</span>
<span>    nutrients <span class="op">=</span> <span class="st">"nitrogen"</span>, </span>
<span>    include_wwtp <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="quality-control">Quality Control<a class="anchor" aria-label="anchor" href="#quality-control"></a>
</h2>
<div class="section level3">
<h3 id="validate-your-data">Validate Your Data<a class="anchor" aria-label="anchor" href="#validate-your-data"></a>
</h3>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Check your results make sense</span></span>
<span><span class="fu"><a href="../reference/quick_check.html">quick_check</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Look at the classifications</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">agricultural</span><span class="op">$</span><span class="va">N_class</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check WWTP facility counts</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="st">"wwtp"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"WWTP facilities:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">wwtp</span><span class="op">$</span><span class="va">nitrogen</span><span class="op">$</span><span class="va">facility_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="common-data-issues">Common Data Issues<a class="anchor" aria-label="anchor" href="#common-data-issues"></a>
</h3>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Problem: Negative nutrient values</span></span>
<span><span class="co"># Solution: Check your data source and units</span></span>
<span></span>
<span><span class="co"># Problem: All facilities excluded  </span></span>
<span><span class="co"># Solution: Check coordinate system (should be decimal degrees)</span></span>
<span></span>
<span><span class="co"># Problem: No WWTP facilities found</span></span>
<span><span class="co"># Solution: Check facility coordinates are in correct format</span></span>
<span></span>
<span><span class="co"># Problem: Classification doesn't make sense</span></span>
<span><span class="co"># Solution: Check cropland threshold and nutrient balance calculations</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="working-with-multiple-years">Working with Multiple Years<a class="anchor" aria-label="anchor" href="#working-with-multiple-years"></a>
</h2>
<div class="section level3">
<h3 id="time-series-analysis">Time Series Analysis<a class="anchor" aria-label="anchor" href="#time-series-analysis"></a>
</h3>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Analyze multiple years</span></span>
<span><span class="va">years_to_analyze</span> <span class="op">&lt;-</span> <span class="fl">2014</span><span class="op">:</span><span class="fl">2016</span></span>
<span></span>
<span><span class="va">batch_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/batch_analysis_years.html">batch_analysis_years</a></span><span class="op">(</span></span>
<span>  years <span class="op">=</span> <span class="va">years_to_analyze</span>,</span>
<span>  scale <span class="op">=</span> <span class="st">"huc8"</span>,</span>
<span>  nutrients <span class="op">=</span> <span class="st">"nitrogen"</span>, </span>
<span>  include_wwtp <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># With custom WWTP data for some years</span></span>
<span><span class="va">custom_wwtp_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"2018"</span> <span class="op">=</span> <span class="st">"nitrogen_2018.csv"</span>,</span>
<span>  <span class="st">"2019"</span> <span class="op">=</span> <span class="st">"nitrogen_2019.csv"</span>, </span>
<span>  <span class="st">"2020"</span> <span class="op">=</span> <span class="st">"nitrogen_2020.csv"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Process each year with custom data</span></span>
<span><span class="va">custom_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">year</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">custom_wwtp_files</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">custom_results</span><span class="op">[[</span><span class="va">year</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_builtin_analysis.html">run_builtin_analysis</a></span><span class="op">(</span></span>
<span>    scale <span class="op">=</span> <span class="st">"county"</span>,</span>
<span>    year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span>,</span>
<span>    nutrients <span class="op">=</span> <span class="st">"nitrogen"</span>,</span>
<span>    include_wwtp <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    custom_wwtp_nitrogen <span class="op">=</span> <span class="va">custom_wwtp_files</span><span class="op">[[</span><span class="va">year</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="data-management-tips">Data Management Tips<a class="anchor" aria-label="anchor" href="#data-management-tips"></a>
</h2>
<div class="section level3">
<h3 id="file-organization">File Organization<a class="anchor" aria-label="anchor" href="#file-organization"></a>
</h3>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Organize your data files</span></span>
<span><span class="co"># project_folder/</span></span>
<span><span class="co">#   â”œâ”€â”€ wwtp_data/</span></span>
<span><span class="co">#   â”‚   â”œâ”€â”€ nitrogen_2018.csv</span></span>
<span><span class="co">#   â”‚   â”œâ”€â”€ nitrogen_2019.csv</span></span>
<span><span class="co">#   â”‚   â””â”€â”€ phosphorus_2018.csv</span></span>
<span><span class="co">#   â”œâ”€â”€ results/</span></span>
<span><span class="co">#   â””â”€â”€ maps/</span></span>
<span></span>
<span><span class="co"># Set working directory</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">setwd</a></span><span class="op">(</span><span class="st">"project_folder"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run analysis with organized files</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_builtin_analysis.html">run_builtin_analysis</a></span><span class="op">(</span></span>
<span>  scale <span class="op">=</span> <span class="st">"huc8"</span>,</span>
<span>  year <span class="op">=</span> <span class="fl">2018</span>,</span>
<span>  nutrients <span class="op">=</span> <span class="st">"nitrogen"</span>,</span>
<span>  include_wwtp <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  custom_wwtp_nitrogen <span class="op">=</span> <span class="st">"wwtp_data/nitrogen_2018.csv"</span>,</span>
<span>  output_dir <span class="op">=</span> <span class="st">"results"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="memory-management">Memory Management<a class="anchor" aria-label="anchor" href="#memory-management"></a>
</h3>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># For large datasets, clear cache periodically</span></span>
<span><span class="fu"><a href="../reference/clear_data_cache.html">clear_data_cache</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check package health</span></span>
<span><span class="fu"><a href="../reference/health_check.html">health_check</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Free up memory between analyses</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">large_results</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/gc.html" class="external-link">gc</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="example-complete-custom-workflow">Example: Complete Custom Workflow<a class="anchor" aria-label="anchor" href="#example-complete-custom-workflow"></a>
</h2>
<p>Here’s a complete example using custom data:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 1. Prepare your WWTP file (nitrogen_2021.csv)</span></span>
<span><span class="co"># Make sure it has columns: Facility Name, Latitude, Longitude, Load (kg/yr), State</span></span>
<span></span>
<span><span class="co"># 2. Run analysis</span></span>
<span><span class="va">results_custom</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_builtin_analysis.html">run_builtin_analysis</a></span><span class="op">(</span></span>
<span>  scale <span class="op">=</span> <span class="st">"huc8"</span>,</span>
<span>  year <span class="op">=</span> <span class="fl">2021</span>,  <span class="co"># Agricultural data extrapolated to 2021</span></span>
<span>  nutrients <span class="op">=</span> <span class="st">"nitrogen"</span>,</span>
<span>  include_wwtp <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  custom_wwtp_nitrogen <span class="op">=</span> <span class="st">"nitrogen_2021.csv"</span>,</span>
<span>  wwtp_load_units <span class="op">=</span> <span class="st">"kg"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 3. Check results</span></span>
<span><span class="fu"><a href="../reference/summarize_results.html">summarize_results</a></span><span class="op">(</span><span class="va">results_custom</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/quick_check.html">quick_check</a></span><span class="op">(</span><span class="va">results_custom</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 4. Create maps</span></span>
<span><span class="va">nitrogen_map</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/map_agricultural_classification.html">map_agricultural_classification</a></span><span class="op">(</span></span>
<span>  <span class="va">results_custom</span><span class="op">$</span><span class="va">integrated</span><span class="op">$</span><span class="va">nitrogen</span>,</span>
<span>  <span class="st">"nitrogen"</span>, <span class="st">"combined_N_class"</span>,</span>
<span>  <span class="st">"2021 Nitrogen with Custom WWTP Data"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/save_plot.html">save_plot</a></span><span class="op">(</span><span class="va">nitrogen_map</span>, <span class="st">"custom_analysis_2021.png"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 5. Save results</span></span>
<span><span class="fu"><a href="../reference/save_spatial_data.html">save_spatial_data</a></span><span class="op">(</span></span>
<span>  <span class="va">results_custom</span><span class="op">$</span><span class="va">integrated</span><span class="op">$</span><span class="va">nitrogen</span>,</span>
<span>  <span class="st">"nitrogen_2021_results.rds"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="integration-issues">Integration Issues<a class="anchor" aria-label="anchor" href="#integration-issues"></a>
</h3>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Common integration problems</span></span>
<span></span>
<span><span class="co"># Problem: WWTP facilities not matching spatial units</span></span>
<span><span class="co"># Solution: Check coordinate systems and boundary files</span></span>
<span><span class="va">check_wwtp_spatial_match</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">wwtp_data</span>, <span class="va">boundaries</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># Convert WWTP to spatial</span></span>
<span>  <span class="va">wwtp_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">wwtp_data</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Long"</span>, <span class="st">"Lat"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span>  <span class="va">wwtp_projected</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">wwtp_sf</span>, <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">boundaries</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Check spatial intersection</span></span>
<span>  <span class="va">intersections</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html" class="external-link">st_intersects</a></span><span class="op">(</span><span class="va">wwtp_projected</span>, <span class="va">boundaries</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Count facilities per spatial unit</span></span>
<span>  <span class="va">matches</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lengths.html" class="external-link">lengths</a></span><span class="op">(</span><span class="va">intersections</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"WWTP spatial matching summary:"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"  Total facilities: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">wwtp_data</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"  Facilities matched to boundaries: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">matches</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"  Facilities not matched: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">matches</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">matches</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">unmatched</span> <span class="op">&lt;-</span> <span class="va">wwtp_data</span><span class="op">[</span><span class="va">matches</span> <span class="op">==</span> <span class="fl">0</span>, <span class="op">]</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"  Check coordinates for unmatched facilities"</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">unmatched</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">matches</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Problem: Scale mismatch between data sources</span></span>
<span><span class="co"># Solution: Ensure consistent spatial scales</span></span>
<span><span class="va">verify_scale_consistency</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">agricultural_data</span>, <span class="va">wwtp_data</span>, <span class="va">scale</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Scale consistency check for: "</span>, <span class="va">scale</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Check ID formats</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">scale</span> <span class="op">==</span> <span class="st">"county"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># FIPS codes should be 5 digits</span></span>
<span>    <span class="va">invalid_fips</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="va">agricultural_data</span><span class="op">$</span><span class="va">ID</span><span class="op">)</span> <span class="op">!=</span> <span class="fl">5</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"  Invalid FIPS codes: "</span>, <span class="va">invalid_fips</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">scale</span> <span class="op">==</span> <span class="st">"huc8"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># HUC8 codes should be 8 digits</span></span>
<span>    <span class="va">invalid_huc8</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="va">agricultural_data</span><span class="op">$</span><span class="va">ID</span><span class="op">)</span> <span class="op">!=</span> <span class="fl">8</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"  Invalid HUC8 codes: "</span>, <span class="va">invalid_huc8</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># Check coordinate ranges</span></span>
<span>  <span class="va">coord_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    lat_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">wwtp_data</span><span class="op">$</span><span class="va">Lat</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    long_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">wwtp_data</span><span class="op">$</span><span class="va">Long</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"  WWTP coordinate ranges:"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"    Latitude: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">coord_summary</span><span class="op">$</span><span class="va">lat_range</span>, <span class="fl">2</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">" to "</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"    Longitude: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">coord_summary</span><span class="op">$</span><span class="va">long_range</span>, <span class="fl">2</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">" to "</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">coord_summary</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="best-practices-for-custom-data">Best Practices for Custom Data<a class="anchor" aria-label="anchor" href="#best-practices-for-custom-data"></a>
</h2>
<div class="section level3">
<h3 id="file-organization-1">File Organization<a class="anchor" aria-label="anchor" href="#file-organization-1"></a>
</h3>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Recommended project structure</span></span>
<span><span class="va">create_project_structure</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">project_name</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># Create main directories</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">project_name</span>, showWarnings <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">project_name</span>, <span class="st">"data"</span><span class="op">)</span>, showWarnings <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">project_name</span>, <span class="st">"data"</span>, <span class="st">"wwtp"</span><span class="op">)</span>, showWarnings <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">project_name</span>, <span class="st">"data"</span>, <span class="st">"agricultural"</span><span class="op">)</span>, showWarnings <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">project_name</span>, <span class="st">"results"</span><span class="op">)</span>, showWarnings <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">project_name</span>, <span class="st">"maps"</span><span class="op">)</span>, showWarnings <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">project_name</span>, <span class="st">"exports"</span><span class="op">)</span>, showWarnings <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Create README</span></span>
<span>  <span class="va">readme_content</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span></span>
<span>    <span class="st">"# Manureshed Analysis Project"</span>,</span>
<span>    <span class="st">""</span>,</span>
<span>    <span class="st">"## Data Files"</span>,</span>
<span>    <span class="st">"- data/wwtp/ - WWTP facility data files"</span>,</span>
<span>    <span class="st">"- data/agricultural/ - Custom agricultural data"</span>,</span>
<span>    <span class="st">""</span>,</span>
<span>    <span class="st">"## Outputs"</span>, </span>
<span>    <span class="st">"- results/ - Analysis results (.rds files)"</span>,</span>
<span>    <span class="st">"- maps/ - Generated maps (.png files)"</span>,</span>
<span>    <span class="st">"- exports/ - Exported data (.csv, .shp files)"</span>,</span>
<span>    <span class="st">""</span>,</span>
<span>    <span class="st">"## Analysis Scripts"</span>,</span>
<span>    <span class="st">"- analysis.R - Main analysis script"</span>,</span>
<span>    <span class="st">""</span>,</span>
<span>    sep <span class="op">=</span> <span class="st">"\n"</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span><span class="va">readme_content</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">project_name</span>, <span class="st">"README.md"</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Project structure created: "</span>, <span class="va">project_name</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Add your data files to the appropriate folders"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Create organized project</span></span>
<span><span class="co"># create_project_structure("my_nutrient_analysis")</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="data-documentation">Data Documentation<a class="anchor" aria-label="anchor" href="#data-documentation"></a>
</h3>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Document your custom data sources</span></span>
<span><span class="va">document_data_sources</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">wwtp_files</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">agricultural_files</span> <span class="op">=</span> <span class="cn">NULL</span>, </span>
<span>                                 <span class="va">output_file</span> <span class="op">=</span> <span class="st">"data_documentation.txt"</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">doc_content</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"DATA SOURCES DOCUMENTATION"</span>,</span>
<span>    <span class="st">"============================"</span>,</span>
<span>    <span class="st">""</span>,</span>
<span>    <span class="st">"Analysis Date: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.Date</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="st">"Package Version: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html" class="external-link">packageVersion</a></span><span class="op">(</span><span class="st">"manureshed"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="st">""</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">wwtp_files</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">doc_content</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">doc_content</span>,</span>
<span>      <span class="st">"WWTP DATA FILES:"</span>,</span>
<span>      <span class="st">"----------------"</span></span>
<span>    <span class="op">)</span></span>
<span>    </span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">file</span> <span class="kw">in</span> <span class="va">wwtp_files</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">file_info</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.info.html" class="external-link">file.info</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span></span>
<span>        <span class="va">doc_content</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">doc_content</span>,</span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"File:"</span>, <span class="va">file</span><span class="op">)</span>,</span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"  Size:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">file_info</span><span class="op">$</span><span class="va">size</span> <span class="op">/</span> <span class="fl">1024</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"KB"</span><span class="op">)</span>,</span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"  Modified:"</span>, <span class="va">file_info</span><span class="op">$</span><span class="va">mtime</span><span class="op">)</span>,</span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"  Rows:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>          <span class="st">""</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">agricultural_files</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">doc_content</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">doc_content</span>,</span>
<span>      <span class="st">"AGRICULTURAL DATA FILES:"</span>,</span>
<span>      <span class="st">"------------------------"</span></span>
<span>    <span class="op">)</span></span>
<span>    </span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">file</span> <span class="kw">in</span> <span class="va">agricultural_files</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">file_info</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.info.html" class="external-link">file.info</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span></span>
<span>        <span class="va">doc_content</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">doc_content</span>,</span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"File:"</span>, <span class="va">file</span><span class="op">)</span>,</span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"  Size:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">file_info</span><span class="op">$</span><span class="va">size</span> <span class="op">/</span> <span class="fl">1024</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"KB"</span><span class="op">)</span>,</span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"  Modified:"</span>, <span class="va">file_info</span><span class="op">$</span><span class="va">mtime</span><span class="op">)</span>,</span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"  Rows:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>          <span class="st">""</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">doc_content</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">doc_content</span>,</span>
<span>    <span class="st">"ANALYSIS PARAMETERS:"</span>,</span>
<span>    <span class="st">"--------------------"</span>,</span>
<span>    <span class="st">"Built-in data years: 1987-2016 (Agricultural), 2007-2016 (WWTP)"</span>,</span>
<span>    <span class="st">"Spatial scales: county, huc8, huc2"</span>,</span>
<span>    <span class="st">"Default cropland threshold: 500 ha (1,234 acres)"</span>,</span>
<span>    <span class="st">""</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span><span class="va">doc_content</span>, <span class="va">output_file</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Data documentation saved to: "</span>, <span class="va">output_file</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Use documentation function</span></span>
<span><span class="co"># document_data_sources(</span></span>
<span><span class="co">#   wwtp_files = c("data/wwtp/nitrogen_2020.csv", "data/wwtp/phosphorus_2020.csv"),</span></span>
<span><span class="co">#   agricultural_files = c("data/agricultural/custom_farm_data.csv")</span></span>
<span><span class="co"># )</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="quality-assurance-workflow">Quality Assurance Workflow<a class="anchor" aria-label="anchor" href="#quality-assurance-workflow"></a>
</h3>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Complete quality assurance workflow</span></span>
<span><span class="va">quality_assurance_workflow</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">results</span>, <span class="va">data_sources</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">qa_report</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">qa_report</span><span class="op">$</span><span class="va">timestamp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">qa_report</span><span class="op">$</span><span class="va">data_sources</span> <span class="op">&lt;-</span> <span class="va">data_sources</span></span>
<span>  </span>
<span>  <span class="co"># 1. Basic data checks</span></span>
<span>  <span class="va">qa_report</span><span class="op">$</span><span class="va">basic_checks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    total_spatial_units <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">agricultural</span><span class="op">)</span>,</span>
<span>    missing_classifications <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">agricultural</span><span class="op">$</span><span class="va">N_class</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># 2. Classification distribution</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="st">"N_class"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">agricultural</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">n_dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">agricultural</span><span class="op">$</span><span class="va">N_class</span><span class="op">)</span></span>
<span>    <span class="va">qa_report</span><span class="op">$</span><span class="va">classification_distribution</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      nitrogen <span class="op">=</span> <span class="va">n_dist</span>,</span>
<span>      excluded_percentage <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">n_dist</span><span class="op">[</span><span class="st">"Excluded"</span><span class="op">]</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">n_dist</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># 3. WWTP integration checks</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="st">"wwtp"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">qa_report</span><span class="op">$</span><span class="va">wwtp_checks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">nutrient</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">wwtp</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">facilities</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">$</span><span class="va">wwtp</span><span class="op">[[</span><span class="va">nutrient</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">facility_data</span></span>
<span>      <span class="va">qa_report</span><span class="op">$</span><span class="va">wwtp_checks</span><span class="op">[[</span><span class="va">nutrient</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        total_facilities <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">facilities</span><span class="op">)</span>,</span>
<span>        facilities_with_loads <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">facilities</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">toupper</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">nutrient</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>, <span class="st">"_Load_tons"</span><span class="op">)</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># 4. Spatial validation</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">inherits</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">agricultural</span>, <span class="st">"sf"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">qa_report</span><span class="op">$</span><span class="va">spatial_checks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      invalid_geometries <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/valid.html" class="external-link">st_is_valid</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">agricultural</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      crs <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">agricultural</span><span class="op">)</span><span class="op">$</span><span class="va">input</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># 5. Range checks</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="st">"integrated"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">nutrient</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">integrated</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">data</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">$</span><span class="va">integrated</span><span class="op">[[</span><span class="va">nutrient</span><span class="op">]</span><span class="op">]</span></span>
<span>      <span class="va">surplus_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">nutrient</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"_surplus"</span><span class="op">)</span></span>
<span>      </span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="va">surplus_col</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">qa_report</span><span class="op">$</span><span class="va">range_checks</span><span class="op">[[</span><span class="va">nutrient</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          min_surplus <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">data</span><span class="op">[[</span><span class="va">surplus_col</span><span class="op">]</span><span class="op">]</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>          max_surplus <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">data</span><span class="op">[[</span><span class="va">surplus_col</span><span class="op">]</span><span class="op">]</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>          extreme_values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">data</span><span class="op">[[</span><span class="va">surplus_col</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1000</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># Generate QA summary</span></span>
<span>  <span class="va">qa_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    passed <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    warnings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    errors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Check for issues</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">qa_report</span><span class="op">$</span><span class="va">basic_checks</span><span class="op">$</span><span class="va">missing_classifications</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">qa_summary</span><span class="op">$</span><span class="va">warnings</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">qa_summary</span><span class="op">$</span><span class="va">warnings</span>, </span>
<span>                             <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Missing classifications:"</span>, <span class="va">qa_report</span><span class="op">$</span><span class="va">basic_checks</span><span class="op">$</span><span class="va">missing_classifications</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">qa_report</span><span class="op">$</span><span class="va">classification_distribution</span><span class="op">$</span><span class="va">excluded_percentage</span> <span class="op">&gt;</span> <span class="fl">50</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">qa_summary</span><span class="op">$</span><span class="va">warnings</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">qa_summary</span><span class="op">$</span><span class="va">warnings</span>,</span>
<span>                             <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"High exclusion rate:"</span>, <span class="va">qa_report</span><span class="op">$</span><span class="va">classification_distribution</span><span class="op">$</span><span class="va">excluded_percentage</span>, <span class="st">"%"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="st">"spatial_checks"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">qa_report</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="va">qa_report</span><span class="op">$</span><span class="va">spatial_checks</span><span class="op">$</span><span class="va">invalid_geometries</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">qa_summary</span><span class="op">$</span><span class="va">errors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">qa_summary</span><span class="op">$</span><span class="va">errors</span>,</span>
<span>                           <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Invalid geometries:"</span>, <span class="va">qa_report</span><span class="op">$</span><span class="va">spatial_checks</span><span class="op">$</span><span class="va">invalid_geometries</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">qa_summary</span><span class="op">$</span><span class="va">passed</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># Print summary</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Quality Assurance Summary:"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"  Status: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">qa_summary</span><span class="op">$</span><span class="va">passed</span>, <span class="st">"PASSED"</span>, <span class="st">"FAILED"</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">qa_summary</span><span class="op">$</span><span class="va">warnings</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"  Warnings:"</span><span class="op">)</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">warning</span> <span class="kw">in</span> <span class="va">qa_summary</span><span class="op">$</span><span class="va">warnings</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"    - "</span>, <span class="va">warning</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">qa_summary</span><span class="op">$</span><span class="va">errors</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"  Errors:"</span><span class="op">)</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">error</span> <span class="kw">in</span> <span class="va">qa_summary</span><span class="op">$</span><span class="va">errors</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"    - "</span>, <span class="va">error</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">qa_report</span><span class="op">$</span><span class="va">summary</span> <span class="op">&lt;-</span> <span class="va">qa_summary</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">qa_report</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Run QA workflow</span></span>
<span><span class="co"># qa_results &lt;- quality_assurance_workflow(results_custom, "Custom 2021 WWTP data")</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="getting-help-1">Getting Help<a class="anchor" aria-label="anchor" href="#getting-help-1"></a>
</h2>
<div class="section level3">
<h3 id="common-questions-1">Common Questions<a class="anchor" aria-label="anchor" href="#common-questions-1"></a>
</h3>
<p><strong>Q: What format should my WWTP data be in?</strong> A: CSV
file with columns for facility name, latitude, longitude, annual load,
and state. The package can auto-detect most EPA formats.</p>
<p><strong>Q: What units can I use for loads?</strong><br>
A: “kg”, “lbs”, “pounds”, or “tons”. Specify with
<code>wwtp_load_units</code>.</p>
<p><strong>Q: Can I use data from other countries?</strong> A: The
spatial boundaries are US-only, but you could provide your own
boundaries and modify the coordinate system.</p>
<p><strong>Q: How do I handle missing data?</strong> A: The package
excludes facilities with missing coordinates or loads. Clean your data
first for best results.</p>
<p><strong>Q: My analysis is running slowly. What can I do?</strong> A:
Try using a smaller spatial scale (HUC2 &lt; HUC8 &lt; County in terms
of processing time), fewer years, or clear the data cache with
<code><a href="../reference/clear_data_cache.html">clear_data_cache()</a></code>.</p>
<p><strong>Q: How do I cite the package and data?</strong> A: Use
<code><a href="../reference/citation_info.html">citation_info()</a></code> to get proper citations for the package and
underlying datasets.</p>
<p><strong>Q: Can I analyze partial years or seasonal data?</strong> A:
The package is designed for annual data. For seasonal analysis, you
would need to aggregate your data to annual totals first.</p>
<p><strong>Q: What if my WWTP data has different pollutant
measurements?</strong> A: The package expects total nitrogen and total
phosphorus loads. If you have other forms (NO3, NH4, PO4), you’ll need
to convert to total N and P first.</p>
</div>
<div class="section level3">
<h3 id="function-help-1">Function Help<a class="anchor" aria-label="anchor" href="#function-help-1"></a>
</h3>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get help on specific functions</span></span>
<span><span class="op">?</span><span class="va">load_user_wwtp</span></span>
<span><span class="op">?</span><span class="va">run_builtin_analysis</span>  </span>
<span><span class="op">?</span><span class="va">wwtp_clean_data</span></span>
<span><span class="op">?</span><span class="va">validate_columns</span></span>
<span></span>
<span><span class="co"># Check what data is available</span></span>
<span><span class="fu"><a href="../reference/check_builtin_data.html">check_builtin_data</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/list_available_years.html">list_available_years</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Package health check</span></span>
<span><span class="fu"><a href="../reference/health_check.html">health_check</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Test data download connection</span></span>
<span><span class="fu"><a href="../reference/test_osf_connection.html">test_osf_connection</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="getting-more-help-1">Getting More Help<a class="anchor" aria-label="anchor" href="#getting-more-help-1"></a>
</h3>
<ul>
<li>Check the other vignettes: <code><a href="../articles/getting-started.html">vignette("getting-started")</a></code>,
<code><a href="../articles/visualization-guide.html">vignette("visualization-guide")</a></code>,
<code><a href="../articles/advanced-features.html">vignette("advanced-features")</a></code>
</li>
<li>Look at function documentation: <code>?function_name</code>
</li>
<li>Check the package website or GitHub repository for examples</li>
<li>Use <code><a href="../reference/quick_check.html">quick_check()</a></code> to validate your results</li>
<li>Run <code><a href="../reference/health_check.html">health_check()</a></code> if you encounter installation or
data loading issues</li>
</ul>
</div>
<div class="section level3">
<h3 id="reporting-issues">Reporting Issues<a class="anchor" aria-label="anchor" href="#reporting-issues"></a>
</h3>
<p>If you encounter bugs or have feature requests:</p>
<ol style="list-style-type: decimal">
<li>Check that your data format matches the expected format</li>
<li>Run <code><a href="../reference/health_check.html">health_check()</a></code> to verify package installation</li>
<li>Try with built-in data first to isolate the issue</li>
<li>Document the error message and steps to reproduce</li>
<li>Check the package documentation and vignettes</li>
<li>Report issues with a minimal reproducible example</li>
</ol>
<p>The <code>manureshed</code> package is designed to work with your
data as easily as possible. Start with the built-in examples, then
gradually add your own data as needed. The key is to ensure your data is
properly formatted and validated before running the analysis.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://orcid.org/0000-0001-7719-2619" class="external-link">Olatunde D. Akanbi</a> et al. at Case Western Reserve University</p>
</div>

<div class="pkgdown-footer-right">
  <p>Built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> and <a href="https://www.r-project.org/" class="external-link">R</a></p>
</div>

    </footer>
</div>





  </body>
</html>
