person("Jeffrey M.", "Yarus"),
person("Erika I.", "Barcelos"),
person("Roger H.", "French")
),
journal  = "Resources, Conservation and Recycling",
year     = "2025"
)
# Optional: Data source info as a footer
citFooter("DATA SOURCES:
NuGIS Agricultural Data (1987-2016): NuGIS (Nutrient Use Geographic Information System), The Fertilizer Institute (TFI) and Plant Nutrition Canada (PNC), https://nugis.tfi.org/tabular_data.
EPA WWTP Discharge Data (2007-2016): U.S. Environmental Protection Agency (EPA), DMR Loading Tool, ECHO, https://echo.epa.gov/trends/loading-tool/water-pollution-search.
For questions about data usage and attribution, contact NuGIS: nugis@tfi.org, Package: olatunde.akanbi@case.edu
")
', "inst/CITATION")
citation("manureshed")
devtools::check()
devtools::check()
devtools::check()
devtools::check()
devtools::check()
devtools::check()
devtools::check()
devtools::check()
devtools::check()
gc()
devtools::document()
devtools::check()
roxygen2::roxygenise()
devtools::document()
devtools::build_vignettes()
devtools::document()
devtools::check()
devtools::check()
devtools::check()
list.files("inst/doc")
if (dir.exists("doc")) unlink("doc", recursive = TRUE)
if (dir.exists("inst/doc")) unlink("inst/doc", recursive = TRUE)
devtools::build()
devtools::check_built(
path = "/mnt/vstor/CSE_MSE_RXF131/staging/casf/EE/geospatialsuite-r/packages/manureshed_0.1.0.tar.gz"
)
unlink("build", recursive = TRUE)
unlink("doc", recursive = TRUE)
unlink("inst/doc", recursive = TRUE)
# Rebuild cleanly
built_pkg <- devtools::build()
# Check the built package
devtools::check_built(built_pkg)
list.files("vignettes", pattern = "\\.Rmd$")
Step 1: Clean ALL build artifacts from SOURCE
# Step 1: Clean ALL build artifacts from SOURCE
unlink("build", recursive = TRUE)
unlink("doc", recursive = TRUE)
unlink("inst/doc", recursive = TRUE)
# Step 2: Delete the OLD tarball (it has stale metadata embedded)
unlink("/mnt/vstor/CSE_MSE_RXF131/staging/casf/EE/geospatialsuite-r/packages/manureshed_0.1.0.tar.gz")
# Step 3: Clean rebuild with vignettes
new_pkg <- devtools::build()
print(paste("New package created:", new_pkg))
# Step 4: Check the NEW package
devtools::check_built(new_pkg)
gc()
devtools::build_vignettes()
list.files("doc", full.names = TRUE)
new_pkg <- devtools::build(vignettes = TRUE, quiet = FALSE)
# Step 2: Copy to inst/doc/ (THIS IS THE MISSING STEP!)
if (!dir.exists("inst/doc")) {
dir.create("inst/doc", recursive = TRUE)
}
# Copy all files from doc/ to inst/doc/
file.copy(
from = list.files("doc", full.names = TRUE),
to = "inst/doc/",
overwrite = TRUE,
recursive = TRUE
)
# Verify the copy
list.files("inst/doc")
# Step 3: Now build the package
new_pkg <- devtools::build()
if (!dir.exists("inst/doc")) {
dir.create("inst/doc", recursive = TRUE)
}
file.copy(
from = list.files("doc", full.names = TRUE),
to = "inst/doc/",
overwrite = TRUE,
recursive = TRUE
)
new_pkg <- devtools::build()
if (!dir.exists("inst/doc")) {
dir.create("inst/doc", recursive = TRUE)
}
file.copy(
from = list.files("doc", full.names = TRUE),
to = "inst/doc/",
overwrite = TRUE,
recursive = TRUE
)
devtools::check()
devtools::check()
# Check what's ACTUALLY in the built tarball
system("tar -tzf /mnt/vstor/CSE_MSE_RXF131/staging/casf/EE/geospatialsuite-r/packages/manureshed_0.1.0.tar.gz | grep 'inst/doc'")
# Read current .Rbuildignore
rbuildignore <- readLines(".Rbuildignore")
# Remove the line that excludes all HTML files
rbuildignore <- rbuildignore[rbuildignore != "^.*\\.html$"]
# Write back
writeLines(rbuildignore, ".Rbuildignore")
# Verify
cat("New .Rbuildignore contents:\n")
cat(paste(readLines(".Rbuildignore"), collapse = "\n"), "\n")
devtools::check()
library(foghorn)
a<-cran_incoming()
View(a)
library(foghorn)
a<-cran_incoming()
install.packages("geospatialsuite")
library(geospatialsuite)
library(geospatialsuite)
install.packages("geospatialsuite")
install.packages("geospatialsuite")
library(geospatialsuite)
devtools::document()
devtools::build_manual()
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(dplyr)
library(tidyr)
# Create the dataset
gd_data <- data.frame(
Location = c(rep("Majidun", 3), rep("Agbara", 3)),
Sampling_Point = rep(c("Upstream", "Midstream", "Downstream"), 2),
Water_conc = c(NA, 36.79, 48.75, NA, NA, NA),
Water_sd = c(NA, 0.69, 1.48, NA, NA, NA),
Sediment_conc = c(NA, NA, 178.75, NA, NA, NA),
Sediment_sd = c(NA, NA, 0.43, NA, NA, NA)
)
# Set factor levels for proper ordering
gd_data$Sampling_Point <- factor(gd_data$Sampling_Point,
levels = c("Upstream", "Midstream", "Downstream"))
gd_data$Location <- factor(gd_data$Location, levels = c("Majidun", "Agbara"))
# Reshape to long format
gd_long <- gd_data %>%
pivot_longer(cols = c(Water_conc, Sediment_conc),
names_to = "Matrix",
values_to = "Concentration") %>%
mutate(
SD = case_when(
Matrix == "Water_conc" ~ Water_sd,
Matrix == "Sediment_conc" ~ Sediment_sd
),
Matrix_label = case_when(
Matrix == "Water_conc" ~ "Water (µg/L)",
Matrix == "Sediment_conc" ~ "Sediment (mg/kg)"
),
# For plotting ND values
Concentration_plot = ifelse(is.na(Concentration), 0, Concentration),
is_ND = is.na(Concentration)
)
ggplot(gd_long, aes(x = Sampling_Point, y = Concentration_plot, fill = Location)) +
geom_bar(stat = "identity", position = position_dodge(width = 0.8), width = 0.7) +
geom_errorbar(
data = gd_long %>% filter(!is_ND),
aes(ymin = Concentration_plot - SD, ymax = Concentration_plot + SD),
position = position_dodge(width = 0.8),
width = 0.25
) +
geom_text(
data = gd_long %>% filter(is_ND),
aes(label = "ND", y = 0),
position = position_dodge(width = 0.8),
vjust = -0.5,
size = 3.5,
fontface = "bold",
color = "gray40"
) +
facet_wrap(~Matrix_label, scales = "free_y", ncol = 1) +
scale_fill_manual(values = c("Majidun" = "#3498db", "Agbara" = "#e67e22")) +
labs(
title = "Comparative Gadolinium Concentration: Majidun vs Agbara",
x = "Sampling Point",
y = "Concentration",
fill = "Location",
caption = "ND = Not Detected; Error bars = ± SD"
) +
theme_bw() +
theme(
strip.text = element_text(face = "bold", size = 11),
strip.background = element_rect(fill = "gray90"),
legend.position = "bottom",
plot.title = element_text(hjust = 0.5, face = "bold", size = 13),
axis.text.x = element_text(angle = 0, hjust = 0.5)
)
ggplot(gd_long, aes(x = Sampling_Point, y = Concentration_plot, fill = Matrix_label)) +
geom_bar(stat = "identity", position = position_dodge(width = 0.8), width = 0.7) +
geom_errorbar(
data = gd_long %>% filter(!is_ND),
aes(ymin = Concentration_plot - SD, ymax = Concentration_plot + SD),
position = position_dodge(width = 0.8),
width = 0.25
) +
geom_text(
data = gd_long %>% filter(is_ND),
aes(label = "ND", y = 0),
position = position_dodge(width = 0.8),
vjust = -0.5,
size = 3.5,
fontface = "bold",
color = "gray40"
) +
facet_wrap(~Location, ncol = 2) +
scale_fill_manual(values = c("Water (µg/L)" = "#3498db", "Sediment (mg/kg)" = "#e74c3c")) +
labs(
title = "Gadolinium Distribution in Water and Sediment",
subtitle = "Comparison between Majidun and Agbara Locations",
x = "Sampling Point",
y = "Concentration",
fill = "Matrix",
caption = "ND = Not Detected; Error bars = ± SD"
) +
theme_bw() +
theme(
strip.text = element_text(face = "bold", size = 11),
strip.background = element_rect(fill = "gray90"),
legend.position = "bottom",
plot.title = element_text(hjust = 0.5, face = "bold", size = 13),
plot.subtitle = element_text(hjust = 0.5, size = 10),
axis.text.x = element_text(angle = 45, hjust = 1)
)
# ====== OPTION 2: Faceted by Location ======
p2 <- ggplot(gd_long, aes(x = Sampling_Point, y = Concentration_plot, fill = Matrix_label)) +
geom_bar(stat = "identity", position = position_dodge(width = 0.8), width = 0.7) +
geom_errorbar(
data = gd_long %>% filter(!is_ND),
aes(ymin = Concentration_plot - SD, ymax = Concentration_plot + SD),
position = position_dodge(width = 0.8),
width = 0.25
) +
geom_text(
data = gd_long %>% filter(is_ND),
aes(label = "ND", y = 0),
position = position_dodge(width = 0.8),
vjust = -0.5,
size = 3.5,
fontface = "bold",
color = "gray40"
) +
facet_wrap(~Location, ncol = 2) +
scale_fill_manual(values = c("Water (µg/L)" = "#3498db", "Sediment (mg/kg)" = "#e74c3c")) +
labs(
title = "Gadolinium Distribution in Water and Sediment",
subtitle = "Comparison between Majidun and Agbara Locations",
x = "Sampling Point",
y = "Concentration",
fill = "Matrix",
caption = "ND = Not Detected; Error bars = ± SD"
) +
theme_bw() +
theme(
strip.text = element_text(face = "bold", size = 11),
strip.background = element_rect(fill = "gray90"),
legend.position = "bottom",
plot.title = element_text(hjust = 0.5, face = "bold", size = 13),
plot.subtitle = element_text(hjust = 0.5, size = 10),
axis.text.x = element_text(angle = 45, hjust = 1)
)
# ====== OPTION 3: Side-by-side comparison (Water only) ======
water_only <- gd_long %>% filter(Matrix == "Water_conc")
ggplot(water_only, aes(x = Sampling_Point, y = Concentration_plot, fill = Location)) +
geom_bar(stat = "identity", position = position_dodge(width = 0.8), width = 0.7) +
geom_errorbar(
data = water_only %>% filter(!is_ND),
aes(ymin = Concentration_plot - SD, ymax = Concentration_plot + SD),
position = position_dodge(width = 0.8),
width = 0.25
) +
geom_text(
data = water_only %>% filter(is_ND),
aes(label = "ND", y = 0),
position = position_dodge(width = 0.8),
vjust = -0.5,
size = 4,
fontface = "bold"
) +
scale_fill_manual(values = c("Majidun" = "#3498db", "Agbara" = "#95a5a6")) +
labs(
title = "Gadolinium in Water: Majidun vs Agbara",
x = "Sampling Point",
y = "Concentration (µg/L)",
fill = "Location",
caption = "ND = Not Detected; Error bars = ± SD"
) +
theme_minimal() +
theme(
legend.position = "bottom",
plot.title = element_text(hjust = 0.5, face = "bold", size = 13)
)
ggplot(gd_long, aes(x = Sampling_Point, y = Concentration_plot, fill = Location)) +
geom_bar(stat = "identity", position = position_dodge(width = 0.8), width = 0.7) +
geom_errorbar(
data = gd_long %>% filter(!is_ND),
aes(ymin = Concentration_plot - SD, ymax = Concentration_plot + SD),
position = position_dodge(width = 0.8),
width = 0.25
) +
geom_text(
data = gd_long %>% filter(is_ND),
aes(label = "ND", y = 0),
position = position_dodge(width = 0.8),
vjust = -0.5,
size = 3,
fontface = "bold",
color = "gray40"
) +
geom_text(
data = gd_long %>% filter(!is_ND),
aes(label = round(Concentration_plot, 1), y = Concentration_plot),
position = position_dodge(width = 0.8),
vjust = -1.5,
size = 3
) +
facet_wrap(~Matrix_label, scales = "free_y", ncol = 1) +
scale_fill_manual(
values = c("Majidun" = "#2ecc71", "Agbara" = "#9b59b6"),
labels = c("Majidun (Contaminated)", "Agbara (Reference)")
) +
labs(
title = "Comparative Assessment of Gadolinium Contamination",
x = "Sampling Point",
y = "Concentration",
fill = "Location",
caption = "ND = Not Detected; Values shown on bars; Error bars = ± SD"
) +
theme_bw() +
theme(
strip.text = element_text(face = "bold", size = 11),
strip.background = element_rect(fill = "lightyellow"),
legend.position = "bottom",
plot.title = element_text(hjust = 0.5, face = "bold", size = 13),
axis.text.x = element_text(angle = 0, hjust = 0.5)
)
# Data input
gd_data <- data.frame(
Location = c(rep("Majidun", 3), rep("Agbara", 3)),
Point = rep(c("Upstream", "Midstream", "Downstream"), 2),
Water = c(NA, 36.79, 48.75, NA, NA, NA),
Water_SD = c(NA, 0.69, 1.48, NA, NA, NA),
Sediment = c(NA, NA, 178.75, NA, NA, NA),
Sediment_SD = c(NA, NA, 0.43, NA, NA, NA)
)
# Set factor order
gd_data$Point <- factor(gd_data$Point, levels = c("Upstream", "Midstream", "Downstream"))
gd_data$Location <- factor(gd_data$Location, levels = c("Majidun", "Agbara"))
# Reshape for plotting
gd_long <- gd_data %>%
pivot_longer(
cols = c(Water, Sediment),
names_to = "Matrix",
values_to = "Conc"
) %>%
mutate(
SD = ifelse(Matrix == "Water", Water_SD, Sediment_SD),
Matrix = ifelse(Matrix == "Water", "Water (µg/L)", "Sediment (mg/kg)"),
Plot_value = ifelse(is.na(Conc), 0, Conc),
Is_ND = is.na(Conc)
)
# Create plot
plot <- ggplot(gd_long, aes(x = Point, y = Plot_value, fill = Location)) +
geom_bar(stat = "identity", position = position_dodge(0.75), width = 0.65) +
geom_errorbar(
data = subset(gd_long, !Is_ND),
aes(ymin = Plot_value - SD, ymax = Plot_value + SD),
position = position_dodge(0.75),
width = 0.2,
linewidth = 0.5
) +
geom_text(
data = subset(gd_long, Is_ND),
aes(label = "ND"),
position = position_dodge(0.75),
vjust = -0.5,
size = 3.5,
fontface = "bold",
color = "gray30"
) +
facet_wrap(~Matrix, scales = "free_y", ncol = 1, strip.position = "top") +
scale_fill_manual(values = c("Majidun" = "#3498db", "Agbara" = "#e67e22")) +
labs(
title = "Gadolinium Concentration in Water and Sediment",
subtitle = "Comparison between Majidun and Agbara sampling locations",
x = "Sampling Point",
y = "Concentration",
fill = "Location",
caption = "ND = Not Detected; Error bars represent ± 1 SD"
) +
theme_bw(base_size = 12) +
theme(
strip.text = element_text(face = "bold", size = 11),
strip.background = element_rect(fill = "gray90", color = "black"),
legend.position = "bottom",
legend.title = element_text(face = "bold"),
plot.title = element_text(hjust = 0.5, face = "bold", size = 14),
plot.subtitle = element_text(hjust = 0.5, size = 10, color = "gray30"),
plot.caption = element_text(hjust = 0, size = 9, color = "gray40"),
panel.grid.minor = element_blank()
)
# Display plot
print(plot)
# Save plot
ggsave("/home/oda10/CSE_MSE_RXF131/staging/casf/EE/gd_majidun_vs_agbara.png", plot, width = 8, height = 9, dpi = 300, bg = "white")
ggsave("/home/oda10/CSE_MSE_RXF131/staging/casf/EE/gd_comparison_by_location.png", p2, width = 10, height = 6, dpi = 300)
devtools::document()
a <- download_osf_data("NUGIS_N")
a <- download_osf_data("county_boundaries")
a <- a
gc()
# Function to process a single file
add_comments_to_file <- function(file_path) {
# Read the file
lines <- readLines(file_path, warn = FALSE)
# Track modifications
modified <- FALSE
new_lines <- c()
for (i in seq_along(lines)) {
current_line <- lines[i]
# Check if this line contains \dontrun
if (grepl("\\\\dontrun\\{", current_line)) {
# Check if previous line already has a comment
prev_line <- if (i > 1) lines[i - 1] else ""
has_comment <- grepl("#", prev_line)
if (!has_comment) {
# Get the indentation of the current line
indent <- sub("^(\\s*).*", "\\1", current_line)
# Look at nearby context to determine reason
context_start <- max(1, i - 2)
context_end <- min(length(lines), i + 10)
context <- paste(lines[context_start:context_end], collapse = " ")
# Determine appropriate comment based on context
if (grepl("load_user_wwtp|custom.*data", context, ignore.case = TRUE)) {
comment <- paste0(indent, "# Requires user-supplied custom data files")
} else if (grepl("download_all_data|download_osf", context, ignore.case = TRUE)) {
comment <- paste0(indent, "# Downloads large datasets from OSF")
} else if (grepl("batch_analysis|parallel", context, ignore.case = TRUE)) {
comment <- paste0(indent, "# Computationally intensive example")
} else if (grepl("raw_data|raw_wwtp|Hence", context, ignore.case = TRUE)) {
comment <- paste0(indent, "# Requires external data not included in package")
} else {
comment <- paste0(indent, "# Example requires external data or resources")
}
# Add the comment line
new_lines <- c(new_lines, comment)
modified <- TRUE
cat("  Added comment at line", i, "\n")
}
}
# Add the current line
new_lines <- c(new_lines, current_line)
}
# Write back if modified
if (modified) {
writeLines(new_lines, file_path)
return(TRUE)
} else {
return(FALSE)
}
}
# Get all R files in /mnt/project
r_files <- list.files("~/CSE_MSE_RXF131/staging/casf/EE/geospatialsuite-r/packages/manureshed/R", pattern = "\\.R$", full.names = TRUE)
# Process each file
results <- c()
for (file in r_files) {
cat("Processing:", basename(file), "\n")
was_modified <- add_comments_to_file(file)
results <- c(results, was_modified)
if (!was_modified) {
cat("  No changes needed\n")
}
cat("\n")
}
gc()
devtools::document()
devtools::check()
devtools::document()
devtools::check()
devtools::document()
devtools::check()
devtools::check()
devtools::document()
devtools::check()
usethis::use_cran_comments()
devtools::release()
usethis::use_news_md()
devtools::release()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
gc()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::release()
